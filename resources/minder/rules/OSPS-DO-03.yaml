# SPDX-FileCopyrightText: Copyright 2024 The OSPS Baseline Authors
# SPDX-License-Identifier: Apache-2.0
---
# Requires the Security Insights data source to be installed:
# https://github.com/mindersec/minder-rules-and-profiles/blob/main/data-sources/security-insights.yaml
version: v1
release_phase: alpha
type: rule-type
name: OSPS-DO-03
display_name: Ensures a project has user documentation 
short_failure_message: No project documentation process found
severity:
  value: low
context:
  provider: github
description: |
  Checks that the project has published documentation. 
guidance: |
  This rule type checks for the project's documentation. Currently, it looks for
  sources in the Security Insights file.
def:
  in_entity: repository
  rule_schema:
    type: object
  ingest:
    type: git
  eval:
    type: rego
    data_sources:
      - name: securityinsights
    rego:
      type: deny-by-default
      def: |
        package minder
        import rego.v1

        default allow := false

        si = minder.datasource.securityinsights.parse({})
        allow if {
            count(si["documentation"]) > 0
        }
