# SPDX-FileCopyrightText: Copyright 2024 The OSPS Baseline Authors
# SPDX-License-Identifier: Apache-2.0
---
# Requires the Security Insights data source to be installed:
# https://github.com/mindersec/minder-rules-and-profiles/blob/main/data-sources/security-insights.yaml
version: v1
release_phase: alpha
type: rule-type
name: OSPS-BR-06
display_name: Tests that a project has a log tracking functional changes
short_failure_message: No changelog found
severity:
  value: low
context:
  provider: github
description: |
  Checks that the project publishes its changes in a release notes files or
  changelog.
guidance: |
  This rule type looks for a changelog entry in a security insights file.
def:
  in_entity: repository
  rule_schema:
    type: object
  ingest:
    type: git
  eval:
    type: rego
    data_sources:
      - name: securityinsights
    rego:
      type: deny-by-default
      def: |
        package minder
        import rego.v1

        default allow := false

        si = minder.datasource.securityinsights.parse({})
        allow if {
            count(si.header.changelog) > 0
        }
